# reception of network messages. Comment out unneeded functionality
# Supports both unencrypted and TLS-encrypted (OpenSSL) configurations.
# TLS is disabled by default (ENABLE_TLS=off) for backward compatibility.

# Load input modules
module(load="imudp" config.enabled=`echo $ENABLE_UDP`)
# Always load imtcp module - it's required for both plain TCP (port 514) and TLS (port 6514).
# The module is lightweight and harmless if not used (inputs are controlled separately).
module(load="imtcp")
module(load="imrelp" config.enabled=`echo $ENABLE_RELP`)

# UDP input (unencrypted, port 514)
input(	config.enabled=`echo $ENABLE_UDP`
	type="imudp" port="514" ruleset="rs-main")

# TCP input (plain/unencrypted, port 514)
input(	config.enabled=`echo $ENABLE_TCP`
	type="imtcp" port="514" ruleset="rs-main")

# TLS TCP input (encrypted via OpenSSL, port 6514, RFC 5425)
# Requires ENABLE_TLS=on and TLS certificate files to be configured via environment variables:
# TLS_CA_FILE, TLS_CERT_FILE, TLS_KEY_FILE
# Certificates are set per-input to avoid warnings when TLS is disabled
input(	config.enabled=`echo $ENABLE_TLS`
	type="imtcp"
	port="6514"
	ruleset="rs-main"
	streamDriver.Name="ossl"
	streamDriver.Mode="1"
	streamDriver.AuthMode=`echo $TLS_AUTH_MODE`
	streamDriver.caFile=`echo $TLS_CA_FILE`
	streamDriver.certFile=`echo $TLS_CERT_FILE`
	streamDriver.keyFile=`echo $TLS_KEY_FILE`)

# RELP input (port 2514)
input(	config.enabled=`echo $ENABLE_RELP`
	type="imrelp" port="2514" ruleset="rs-main")
