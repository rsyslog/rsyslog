# Sample rsyslog configuration for forwarding logs to ROSI Collector server
# 
# Installation:
# 1. Copy this file to /etc/rsyslog.d/99-forward-to-central.conf
# 2. Replace "CHANGE_ME" with your ROSI Collector server IP address
# 3. Restart rsyslog: sudo systemctl restart rsyslog
# 4. Verify: sudo systemctl status rsyslog
# 5. Test: logger "test message" && tail -f /var/log/syslog
#
# ROSI Collector Server: TCP port 10514

# ============================================================================
# CONFIGURATION - EDIT THE TARGET VALUES BELOW
# ============================================================================
# Replace "CHANGE_ME" in the action blocks below with your central server IP/hostname
# Example: "10.135.0.10" or "central.example.com"
# IMPORTANT: Keep the quotes around the value

# ============================================================================
# RSYSLOG CONFIGURATION
# ============================================================================

# Template for forwarding (uses standard syslog format)
template(name="ForwardFormat" type="string" string="<%PRI%>%TIMESTAMP% %HOSTNAME% %syslogtag%%msg%\\n")

# ============================================================================
# FORWARDING RULES
# ============================================================================

# ============================================================================
# OPTION 1: Forward ALL logs via TCP (default, active)
# ============================================================================
# This forwards all logs to the central server via TCP

*.* action(
    type="omfwd"
    target="CHANGE_ME"
    port="10514"
    protocol="tcp"
    template="ForwardFormat"
    queue.type="LinkedList"
    queue.size="10000"
    queue.discardMark="9000"
    queue.discardSeverity="0"
    queue.saveOnShutdown="on"
    action.resumeRetryCount="-1"
    action.resumeInterval="10"
    queue.filename="forward-queue"
    queue.spoolDirectory="/var/spool/rsyslog"
    queue.maxDiskSpace="100m"
    queue.maxFileSize="10m"
)

# ============================================================================
# OPTION 2: Forward specific facilities/priorities only
# ============================================================================
# Uncomment and customize the examples below to forward only specific logs
# Make sure to comment out OPTION 1 if using this option

# Forward only auth/authpriv logs (security-related):
# if ($syslogfacility-text == "auth" or $syslogfacility-text == "authpriv") then {
#     action(
#         type="omfwd"
#         target="CHANGE_ME"
#         port="10514"
#         protocol="tcp"
#         template="ForwardFormat"
#         queue.type="LinkedList"
#         queue.size="10000"
#     )
# }

# Forward only error and above (severity <= 3):
# if ($syslogseverity <= 3) then {
#     action(
#         type="omfwd"
#         target="CHANGE_ME"
#         port="10514"
#         protocol="tcp"
#         template="ForwardFormat"
#         queue.type="LinkedList"
#         queue.size="10000"
#     )
# }

# Forward specific applications:
# if ($programname == "nginx" or $programname == "apache2") then {
#     action(
#         type="omfwd"
#         target="CHANGE_ME"
#         port="10514"
#         protocol="tcp"
#         template="ForwardFormat"
#         queue.type="LinkedList"
#         queue.size="10000"
#     )
# }

# Forward everything EXCEPT local0 and local1:
# if ($syslogfacility-text != "local0" and $syslogfacility-text != "local1") then {
#     action(
#         type="omfwd"
#         target="CHANGE_ME"
#         port="10514"
#         protocol="tcp"
#         template="ForwardFormat"
#         queue.type="LinkedList"
#         queue.size="10000"
#     )
# }

# ============================================================================
# NOTES
# ============================================================================
# - TCP (port 10514) provides reliable delivery with queue management
# - Make sure firewall allows outbound connections to the central server on port 10514
# - Test connectivity: telnet CENTRAL_SERVER_IP 10514
# - Check rsyslog logs: tail -f /var/log/syslog | grep rsyslog
# - Verify forwarding: Check central server logs after sending test message
# - Replace all instances of "CHANGE_ME" with your actual central server IP/hostname

